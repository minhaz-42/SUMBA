{% extends 'base.html' %}

{% block title %}Upload Samples - SUMBA{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
        <a href="{% url 'datasets' %}" class="text-purple-600 hover:text-purple-700 mb-4 inline-flex items-center gap-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Back to Datasets
        </a>
        <h1 class="text-3xl font-bold text-gray-900 mt-4">Upload Samples</h1>
        <p class="text-gray-600 mt-1">Import gesture samples from JSON files</p>
    </div>
    
    <!-- Upload Form -->
    <div class="bg-white rounded-xl shadow-sm p-8">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="space-y-6">
                <!-- File Drop Zone -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">JSON File *</label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-purple-400 transition-colors"
                         id="dropZone">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <p class="text-gray-600 mb-2">Drop your JSON file here, or</p>
                        <label class="cursor-pointer text-purple-600 hover:text-purple-700 font-medium">
                            browse to upload
                            <input type="file" name="file" accept=".json" class="hidden" id="fileInput" required>
                        </label>
                        <p id="fileName" class="text-sm text-gray-500 mt-2"></p>
                    </div>
                </div>
                
                <!-- Optional: Add to Dataset -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Add to Dataset (optional)</label>
                    <select name="dataset_uuid"
                            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        <option value="">-- Don't add to any dataset --</option>
                        {% for dataset in datasets %}
                        <option value="{{ dataset.uuid }}">{{ dataset.name }}</option>
                        {% endfor %}
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Imported samples will be added to the selected dataset</p>
                </div>
            </div>
            
            <!-- Expected Format -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-medium text-gray-900 mb-2">Expected JSON Format</h3>
                <pre class="text-xs text-gray-600 overflow-x-auto"><code>{
  "language": "ASL",
  "samples": [
    {
      "gloss": "HELLO",
      "transcript": "Hello",
      "fps": 30,
      "frames": [
        {
          "left_hand": [[x, y, z], ...21 joints...],
          "right_hand": [[x, y, z], ...21 joints...],
          "pose": [[x, y, z], ...33 landmarks...]
        },
        ...
      ]
    }
  ]
}</code></pre>
            </div>
            
            <div class="flex justify-end gap-4 mt-8 pt-6 border-t">
                <a href="{% url 'datasets' %}" 
                   class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50">
                    Cancel
                </a>
                <button type="submit" 
                        class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                    Upload & Import
                </button>
            </div>
        </form>
    </div>
</div>

<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const fileName = document.getElementById('fileName');

// File input change
fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        fileName.textContent = `Selected: ${e.target.files[0].name}`;
    }
});

// Drag and drop
dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('border-purple-500', 'bg-purple-50');
});

dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('border-purple-500', 'bg-purple-50');
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('border-purple-500', 'bg-purple-50');
    
    if (e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        fileName.textContent = `Selected: ${e.dataTransfer.files[0].name}`;
    }
});
</script>
{% endblock %}
